# Отчет по Лабораторной работе №0: Торговый автомат

## Общее описание проекта

Данное консольное приложение эмулирует работу вендингового автомата. Оно предоставляет пользователю возможность взаимодействовать с автоматом для покупки товаров, а также имеет административный режим для управления ассортиментом и денежными средствами.

**Основные функции, доступные пользователю:**

- Просмотр списка доступных товаров с их ценами и количеством
- Внесение монет различных номиналов (1, 0.5, 0.2, 0.1 рубля)
- Выбор товара и его получение, при условии достаточной внесенной суммы
- Получение сдачи (если необходимо) и возврат неиспользованных монет при отмене операции

**Административный режим:**

- Пополнение ассортимента товаров
- Загрузка монет в автомат
- Сбор накопленных денежных средств из автомата

## Структура проекта

```
lab_0/
├── Program.cs           # Точка входа в приложение
├── homework.csproj      # Файл проекта
└── core/               # Основные классы системы
    ├── machine.cs      # Класс торгового автомата
    ├── product.cs       # Класс товара
    ├── wallet.cs        # Класс кошелька
    ├── money.cs         # Класс для работы с деньгами
    └── calc.cs          # Класс для расчетов сдачи
```

## Основные компоненты системы

### Файл `Program.cs` - точка входа в приложение

**Назначение:** Основной файл приложения, который инициализирует торговый автомат и обрабатывает пользовательский ввод.

#### Инициализация данных

```csharp
// Создаем список товаров
var products = new List<Product>();
products.Add(new Product(1, "Water", 200, 5));
products.Add(new Product(2, "Soda", 300, 5));
products.Add(new Product(3, "Juice", 300, 5));

// Создаем кошелек автомата с начальными монетами
var machineCoins = new Dictionary<int, int>();
machineCoins[100] = 10;  // 10 монет по 1 рублю
machineCoins[50] = 10;   // 10 монет по 50 копеек
machineCoins[20] = 10;   // 10 монет по 20 копеек
machineCoins[10] = 10;   // 10 монет по 10 копеек
var machineWallet = new Wallet(machineCoins);

// Создаем торговый автомат
var vm = new VendingMachine(products, machineWallet, "admin123");
```

**Объяснение:**

- Создается список товаров с начальными данными (ID, название, цена в копейках, количество)
- Создается кошелек автомата с начальным количеством монет каждого номинала
- Инициализируется торговый автомат с товарами, кошельком и паролем администратора

#### Основной цикл программы

```csharp
while (true)
{
    Console.WriteLine($"Баланс: {Money.Format(vm.CurrentBalanceKop)}");
    Console.WriteLine("1) Показать товары");
    Console.WriteLine("2) Вставить монету");
    Console.WriteLine("3) Купить товар");
    Console.WriteLine("4) Отмена / вернуть монеты");
    Console.WriteLine("5) Режим администратора");
    Console.WriteLine("0) Выход");
    // ...
}
```

**Объяснение:** Бесконечный цикл отображает меню пользователя и обрабатывает выбор через `switch` конструкцию.

### Класс `VendingMachine` (Файл `machine.cs`)

**Назначение:** Основной класс торгового автомата, управляющий всеми операциями.

#### Поля класса

```csharp
private List<Product> products;
private Wallet machineWallet;
private Wallet sessionWallet;
private string adminPassword;
```

**Объяснение:**

- `products` - список товаров в автомате
- `machineWallet` - кошелек автомата с монетами
- `sessionWallet` - временный кошелек для текущей сессии пользователя
- `adminPassword` - пароль для доступа к административным функциям

#### Метод `InsertCoin` - внесение монеты

```csharp
public bool InsertCoin(int denomKop)
{
    if (!Money.IsSupportedCoin(denomKop))
        return false;

    sessionWallet.Add(denomKop);
    return true;
}
```

**Объяснение:** Проверяет, поддерживается ли номинал монеты, и если да - добавляет ее в сессионный кошелек.

#### Метод `Purchase` - покупка товара

**Алгоритм работы:**

1. Находит товар по ID
2. Проверяет наличие товара и достаточность средств
3. Перемещает монеты из сессионного кошелька в основной
4. Рассчитывает сдачу
5. Если сдачу выдать нельзя - возвращает монеты
6. Уменьшает количество товара на 1
7. Выдает сдачу из основного кошелька
8. Очищает сессию

**Объяснение:** Метод выполняет полный цикл покупки с проверкой всех условий и выдачей сдачи.

#### Метод `Cancel` - отмена операции

```csharp
public (bool ok, string message) Cancel()
{
    var coins = sessionWallet.Snapshot();
    var sum = CurrentBalanceKop;
    ClearSession();
    // ...
}
```

**Объяснение:** Возвращает все внесенные в текущей сессии монеты и очищает сессионный кошелек.

### Класс `Product` (Файл `product.cs`)

**Назначение:** Модель товара, хранящая информацию о товарах в автомате.

#### Свойства

```csharp
public int Id { get; }
public string Name { get; }
public int PriceKop { get; }
public int Quantity { get; private set; }
```

**Объяснение:**

- `Id` - уникальный идентификатор товара
- `Name` - название товара
- `PriceKop` - цена в копейках
- `Quantity` - количество товара (можно изменять только через методы класса)

#### Методы управления количеством

```csharp
public bool HasStock => Quantity > 0;

public void AddStock(int amount)
{
    Quantity += amount;
}

public void ConsumeOne()
{
    Quantity--;
}
```

**Объяснение:**

- `HasStock` - проверяет, есть ли товар в наличии
- `AddStock` - добавляет указанное количество товара
- `ConsumeOne` - уменьшает количество на 1 (при покупке)

### Класс `Money` (Файл `money.cs`)

**Назначение:** Статический класс для работы с денежными единицами.

#### Константы и массивы

```csharp
public const int Ruble = 100;
public static int[] SupportedCoins = new int[] { 100, 50, 20, 10 };
```

**Объяснение:**

- `Ruble` - константа, представляющая 1 рубль в копейках (100 копеек)
- `SupportedCoins` - массив поддерживаемых номиналов монет

#### Метод форматирования

```csharp
public static string Format(int amountKop)
{
    double rubles = amountKop / 100.0;
    return $"{rubles:F2} RUB";
}
```

**Объяснение:** Преобразует сумму в копейках в строку формата "X.XX RUB".

#### Проверка поддержки монеты

```csharp
public static bool IsSupportedCoin(int kop)
{
    foreach (var coin in SupportedCoins)
    {
        if (coin == kop)
            return true;
    }
    return false;
}
```

**Объяснение:** Проверяет, поддерживается ли указанный номинал монеты.

### Класс `Wallet` (Файл `wallet.cs`)

**Назначение:** Кошелек для хранения и управления монетами.

#### Поле для хранения монет

```csharp
private Dictionary<int, int> coins;
```

**Объяснение:** Словарь, где ключ - номинал монеты, значение - количество монет этого номинала.

#### Конструкторы

```csharp
public Wallet()
{
    coins = new Dictionary<int, int>();
    foreach (var coin in Money.SupportedCoins)
    {
        coins[coin] = 0;
    }
}

public Wallet(Dictionary<int, int> initial)
{
    coins = new Dictionary<int, int>();
    foreach (var coin in Money.SupportedCoins)
    {
        if (initial.ContainsKey(coin))
        {
            coins[coin] = initial[coin];
        }
        else
        {
            coins[coin] = 0;
        }
    }
}
```

**Объяснение:**

- Первый конструктор создает пустой кошелек
- Второй инициализирует кошелек с заданными значениями

#### Методы управления монетами

```csharp
public int GetCount(int denom)
{
    if (coins.ContainsKey(denom))
        return coins[denom];
    return 0;
}

public void Add(int denom, int count = 1)
{
    if (!coins.ContainsKey(denom))
    {
        coins[denom] = 0;
    }
    coins[denom] += count;
}

public bool TryRemove(int denom, int count = 1)
{
    if (GetCount(denom) < count)
        return false;

    coins[denom] -= count;
    return true;
}
```

**Объяснение:**

- `GetCount` - возвращает количество монет указанного номинала
- `Add` - добавляет указанное количество монет
- `TryRemove` - пытается удалить монеты, возвращает false если недостаточно

#### Расчет общей суммы

```csharp
public int TotalKop()
{
    int sum = 0;
    foreach (var coin in coins)
    {
        sum += coin.Key * coin.Value;
    }
    return sum;
}
```

**Объяснение:** Суммирует стоимость всех монет в кошельке (номинал × количество).

### Класс `Calc` (Файл `calc.cs`)

**Назначение:** Статический класс для математических расчетов, в основном для выдачи сдачи.

#### Метод расчета сдачи

```csharp
public static bool TryMakeChange(int amountKop, Wallet machineWallet, out Dictionary<int, int> change)
{
    change = new Dictionary<int, int>();
    int remaining = amountKop;

    // Пытаемся выдать сдачу, начиная с самых больших монет
    foreach (var denom in Money.SupportedCoins)
    {
        if (remaining <= 0)
            break;

        // Сколько монет этого номинала нужно
        int need = remaining / denom;

        // Сколько монет этого номинала есть в автомате
        int available = machineWallet.GetCount(denom);

        // Берем столько, сколько можем
        int take = need < available ? need : available;

        if (take > 0)
        {
            change[denom] = take;
            remaining -= take * denom;
        }
    }

    // Если остаток равен нулю, значит можем выдать сдачу
    return remaining == 0;
}
```

**Объяснение:**

1. Инициализирует словарь для сдачи
2. Проходит по номиналам монет от большего к меньшему
3. Для каждого номинала рассчитывает, сколько монет нужно и сколько доступно
4. Берет минимальное из этих значений
5. Уменьшает оставшуюся сумму
6. Возвращает true, если всю сдачу удалось выдать

## Принципы ООП в проекте

### Инкапсуляция

- Приватные поля скрыты от внешнего доступа
- Публичные методы предоставляют контролируемый интерфейс
- Свойства с приватными сеттерами защищают данные

**Пример:** Поле `coins` в классе `Wallet` приватное, доступ к нему только через методы `Add()`, `TryRemove()`, `GetCount()`.

### Абстракция

- Сложная логика торгового автомата инкапсулирована в простые методы
- Пользователь работает с высокоуровневыми операциями (покупка, отмена)

**Пример:** Метод `Purchase()` скрывает сложную логику проверок, расчета сдачи и управления кошельками.

### Полиморфизм

- Использование общих типов для работы с разными данными
- Методы работают с абстракциями (списки, словари)

**Пример:** Метод `Purchase()` работает с любым товаром из списка `products`, не зная конкретного типа.

## Обработка ошибок

- **Валидация пользовательского ввода** на всех этапах (проверка формата, диапазона значений)
- **Проверка достаточности средств** и наличия товаров перед покупкой
- **Проверка возможности выдачи сдачи** перед завершением транзакции
- **Информативные сообщения об ошибках** для пользователя

**Примеры:**

- "Товар не найден" - если введен несуществующий ID
- "Недостаточно средств" - если баланс меньше цены товара
- "Невозможно выдать сдачу" - если в автомате недостаточно монет для сдачи

## Используемые технологии

- **C# .NET 10.0** - основной язык и платформа
- **Console I/O** - для взаимодействия с пользователем
- **Implicit Usings** - автоматический импорт базовых пространств имен

## Итоги

Проект демонстрирует базовые принципы объектно-ориентированного программирования:

- **Классы и объекты** - каждый компонент системы представлен отдельным классом
- **Инкапсуляция** - данные и методы сгруппированы в логические единицы
- **Абстракция** - сложная логика скрыта за простыми интерфейсами
- **Модульность** - код разделен на логические модули (кошелек, товар, автомат)

Код написан просто и понятно, что делает его идеальным для изучения основ ООП новичками.
